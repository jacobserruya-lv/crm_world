<template>
    <div class="slds-p-horizontal_large"> 
        <lightning-card  title="Create Wardrobing Asset" icon-name="custom:custom24" class=" slds-p-horizontal_large">
            <br/>
            <div  class=" slds-p-horizontal_small" >
                <c-wrdb-collection-info 
                    refresh-collections={refreshCollections}
                    oncollectionnamechanged={handleCollectionNameChange}>
                </c-wrdb-collection-info>
                <br/>
                <h3 class="slds-section__title slds-theme_shade slds-p-horizontal_small">Upload File</h3>
                <br/>
                <div class="file" style="display: flex;">
                    <abbr title="required" class="slds-required">*</abbr>
                    <lightning-input 
                        multiple
                        type="file"
                        accept={acceptedFormats}
                        label="Upload Assets"
                        onchange={handleUploadFinished}
                    ></lightning-input>
                    <span style="position: relative;left: 20px;top: 10px;">
                        <template if:true={isFileUpload}>
                            <lightning-spinner class="spinner-loader" alternative-text="Loading" size="small"></lightning-spinner>
                        </template>
                    </span>
                    <div 
                        style="
                        width: fit-content;
                        height: 38px;
                        margin-top: auto;
                        margin-left: 4px;"
                        class="slds-box slds-box_x-small background slds-size_1-of-3"
                        > 
                        <lightning-icon size="small" icon-name="doctype:attachment"></lightning-icon>
                        <span style="
                        background-color: rgb(129 153 175);
                        color: white;
                        width: 20px;
                        height: 20px;
                        text-align: center;
                        position: absolute;
                        margin-top: -14px;
                        margin-left: -6px;
                        border-radius: 50%;"
                        >{uploadedFiles.length}</span>      
                    </div>
                    <c-wrdb-asset-info style="display: inline-flex; margin-left: 30px;" onassetinfochange={handleAssetInfoChange}></c-wrdb-asset-info>
                </div>

                <lightning-card if:true={failedToUpload.length} title="We couldn't upload this files">
                    <ul>
                        <template for:each={failedToUpload} for:item="failure">
                            <li style="margin-left: 25px;" key={failure.name}>
                                {failure.name} - ({failure.msg})
                            </li>
                        </template>
                    </ul>
                </lightning-card>
               
                <br/>

                <h3 class="slds-section__title slds-theme_shade slds-p-horizontal_small">Information</h3>

                <br/>

                <div class="picklist-container" style="display: flex;">
                    <div class="picklist"> 
                        <lightning-record-edit-form object-api-name="WRDB_Asset__c" record-id={recordId} data-id ="wrdb_asset">
                            <lightning-messages></lightning-messages>
                            <lightning-input-field onchange={handleScopeChange} required disabled  field-name="scope__c" value={scope}> </lightning-input-field>   
                        </lightning-record-edit-form>
                    </div>
                    <div class="picklist">
                        <lightning-combobox
                        name="progress"
                        label="Zone"
                        value={selectedZone}
                        placeholder="Select an Option"
                        options={zoneOptions}
                        onchange={handleZoneChange}
                        ></lightning-combobox>
                    </div>
                    <div class="picklist">
                        <lightning-combobox
                        name="progress"
                        label="Country"
                        value={selectedCountry}
                        placeholder="Select an Option"
                        options={countryOptions}
                        onchange={handleCountryChange}
                        disabled={disabledCountry}
                        ></lightning-combobox>
                    </div>
                    <div class="picklist">
                        <lightning-combobox
                        name="progress"
                        label="Store"
                        value={selectedStore}
                        placeholder="Select an Option"
                        options={storeOptions}
                        onchange={handleStoreChange}
                        disabled={disabledStore}
                        ></lightning-combobox> 
                    </div>
                </div>

            </div>

            <div slot="footer">
                <lightning-button
                    type="submit"
                    label="Save"
                    disabled={isFileUpload}
                    onclick={handleClick}
                ></lightning-button>

                <template if:true={isLoading}>
                    <div class="text-loader" style="
                        position: absolute;
                        z-index: 10001!important;
                        color: grey;
                        width: 100%;
                        height: 100%;
                        left: 0;
                        top: 55px;
                        font-size: large;
                        display: flex;
                        justify-content: center;
                        align-items: center;"
                        >
                        <span>Uploading files to server, please wait, this may take some time...</span>
                    </div>
                    <lightning-spinner class="spinner-loader" alternative-text="Loading" size="large"></lightning-spinner>
                </template>
            </div>       
        </lightning-card>
    </div>
</template>