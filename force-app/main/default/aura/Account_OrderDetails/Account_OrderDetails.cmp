<aura:component implements="lightning:isUrlAddressable,lightning:actionOverride,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId" controller="Account_OrderDetailsControllerLC">
    
    <!--ATTRIBUTES-->
    <aura:attribute name="orderNumber" type="String" />
    <aura:attribute name="details" type="Object" default=""/>
    <aura:attribute name="message" type="String" />
    <aura:attribute name="orderDetail" type="Object" default=""/>
    <aura:attribute name="backOffice" type="boolean" default="false"/>
    <aura:attribute name="picklistShipping" type="Object" />
    <aura:attribute name="picklistAction" type="Object"/>
    <aura:attribute name="productSKU" type="Object"/>
    <aura:attribute name="storeType" type="String"/>



    <aura:handler event="c:ICX_RefreshOrderDetailsEvent" action="{!c.reloadComponent}" />

    <lightning:workspaceAPI aura:id="workspace"/>
    <!--HANDLER-->
    <aura:handler name="init" value="{!this}" action="{!c.onInit}"/>

    <!--BODY-->
    <aura:if isTrue ="{!not(empty(v.details))}">
        <lightning:layout multipleRows="true">
           
            <!-- Highlight panel Order -->
            <lightning:layoutItem size="12" padding="around-small" >
                <c:ICX_Order_Highlight_Panel order="{!v.orderDetail}"/>
            </lightning:layoutItem>  
            
            <!-- Order Lines -->
            <lightning:layoutItem  size="12" padding="horizontal-small" >
                <div class="slds-tabs_card">
                    <aura:iteration items="{!v.details.orderLines}" var="item" indexVar="index">
                        <c:Account_OrderLineDetails backOfficeUser="{!v.backOffice}"  
                                                    picklistShipping="{!v.picklistShipping}"
                                                    picklistAction="{!v.picklistAction}"
                                                    OrderNumber="{!v.details.OrderId}" 
                                                    OrderLine="{!item}" 
                                                    index ="{!index}" 
                                                    shipments="{!v.details.shipments}"
                                                    accountId = "{!v.orderDetail.account.Id}"
                                                    storeCountry = "{!v.orderDetail.store.StoreCountry__c}"
                                                    skuProductMap="{!v.productSKU}"
                                                    storeType="{!v.storeType}"
                                                    />
                    </aura:iteration>
                </div>
            </lightning:layoutItem>
        </lightning:layout>

        <aura:set attribute="else">
            <aura:if isTrue ="{!not(empty(v.message))}">
              
                <div>
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container">
                            <header class="slds-modal__header">
                                <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate"><lightning:icon size="x-medium" iconName="utility:announcement"/> Order Not Found </h2>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                <aura:if isTrue="{!v.message == '404'}">
                                        <p><ui:outputRichText value="{!$Label.c.ICX_OrderNotExist}"/></p>
                                </aura:if>
                                <aura:if isTrue="{!v.message == '500'}">
                                        <p><ui:outputRichText value="{!$Label.c.ICX_OrderError}"/></p>
                                </aura:if>
                            </div> 
                            <footer class="slds-modal__footer">
                                <button class="slds-button slds-button_neutral" onclick="{!c.closeFocusedTab}">Close</button>
                            </footer>
                            
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>

                <aura:set attribute="else">

                    <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_delayed">
                        <span class="slds-assistive-text">Loading</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>

                </aura:set>
             </aura:if>
            
        </aura:set>
    </aura:if>
</aura:component>